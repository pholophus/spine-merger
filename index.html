<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="https://unpkg.com/merge-images"></script>
</head>
<body>
    <!-- <a href="#main" download="image.png">Download!</a> -->
    <button onclick="myFunction()">Download</button>
    <img id="main" src="" alt="">
    <img src="body.png" alt="">
    <!-- <img src="/body.png" alt="">
    <img src="/eyes.png" alt="">
    <img src="/mouth.png" alt=""> -->
    <script>
        // mergeImages(['body.png', 'eyes.png', 'mouth.png'])
        // mergeImages([
        //     { src: 'body.png', x: 0, y: 0 },
        //     { src: 'eyes.png', x: 32, y: 0 },
        //     { src: 'mouth.png', x: 16, y: 0 }
        // ])
        
        function myFunction(){
                document.getElementById("downloader").download = "image.png";
                document.getElementById("downloader").href = document.getElementById("main").toDataURL("image/png").replace(/^data:image\/[^;]/, 'data:application/octet-stream');
            }
        mergeImages([ 
            {
                src: 'pumpkinhead/body_1.png',
                x: 18,
                y: 2

            },
            // {
            //     src: 'pumpkinhead/body_2.png',
            //     x: 17,
            //     y: 2

            // },
            {
                src: 'pumpkinhead/body_back_backface.png',
                x: 2,
                y: 3

            },
            {
                src: 'pumpkinhead/body_back_front.png',
                x: 2,
                y: 3

            },
            // {
            //     src: 'zombie_boy/eye_1.png',
            //     x: 84,
            //     y: 4

            // },
            // {
            //     src: 'pumpkinhead/eye_2.png',
            //     x: 84,
            //     y: 4

            // },
            // {
            //     src: 'pumpkinhead/eye_3.png',
            //     x: 84,
            //     y: 4

            // },
            // {
            //     src: 'pumpkinhead/eye_emote1.png',
            //     x: 84,
            //     y: 4

            // },
            // {
            //     src: 'pumpkinhead/eye_emote2.png',
            //     x: 84,
            //     y: 4

            // },
            // {
            //     src: 'pumpkinhead/eye_emote3.png',
            //     x: 84,
            //     y: 4

            // },
            {
                src: 'pumpkinhead/float.png',
                x: 72,
                y: 24

            },
            // {
            //     src: 'pampadour/hair_1.png',
            //     x: 103,
            //     y: 5

            // },
            // {
            //     src: 'dancer/hair_back_l.png',
            //     x: 10,
            //     y: 20

            // },
            // {
            //     src: 'dancer/hair_back_r.png',
            //     x: 20,
            //     y: 20

            // },
            {
                src: 'pumpkinhead/hat_accs_back.png',
                x: 82,
                y: 27

            },
            {
                src: 'pumpkinhead/hat_accs_front.png',
                x: 82,
                y: 27

            },
            {
                src: 'pumpkinhead/head_back.png',
                x: 54,
                y: 3

            },
            {
                src: 'zombie_boy/head_main.png',
                x: 33,
                y: 2

            },
            {
                src: 'pumpkinhead/l_hand.png',
                x: 95,
                y: 24

            },
            // {
            //     src: 'pumpkinhead/l_leg.png',
            //     x: 95,
            //     y: 17

            // },
            {
                src: 'pumpkinhead/mouth_1.png',
                x: 10,
                y: 16

            },
            {
                src: 'pumpkinhead/mouth_2.png',
                x: 10,
                y: 16
            },
            {
                src: 'pumpkinhead/mouth_3.png',
                x: 10,
                y: 16
            },
            {
                src: 'pumpkinhead/mouth_emote1.png',
                x: 10,
                y: 16
            },
            {
                src: 'pumpkinhead/mouth_emote2.png',
                x: 10,
                y: 16
            },
            {
                src: 'pumpkinhead/mouth_emote3.png',
                x: 10,
                y: 16
            },
            {
                src: 'pumpkinhead/r_hand.png',
                x: 84,
                y: 11
            },
            // {
            //     src: 'pumpkinhead/r_leg.png',
            //     x: 95,
            //     y: 11
            // },
            {
                src: 'pumpkinhead/shadow.png',
                x: 108,
                y: 31
            },
            {
                src: 'pumpkinhead/shield.png',
                x: 93,
                y: 31
            },
            {
                src: 'pumpkinhead/vanity_back_backface.png',
                x: 30,
                y: 22
            },
            {
                src: 'pumpkinhead/vanity_back_front.png',
                x: 51,
                y: 22
            },
            {
                src: 'pumpkinhead/weapon.png',
                x: 2,
                y: 16
            }
        ], {
                width:140,
                height: 46
            })
            .then(b64 => document.getElementById('main').src = b64);
        
            // document.getElementById('img').setAttribute( 'src', 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAAHElEQVQI12P4//8/w38GIAXDIBKE0DHxgljNBAAO9TXL0Y4OHwAAAABJRU5ErkJggg==' );

            function myFunction(){
                const img = document.getElementById('main')

                fetch(img.src)
                .then(res => res.blob())
                .then(blob => {
                const file = new File([blob], 'dot.png', blob)

                let url = 'http://localhost:3000/fileupload'

                let formData = new FormData()

                formData.append('file', file)

                fetch(url, {
                  method: 'POST',
                  body: formData
                })
                .then(() => { })
                .catch(() => { /* Error. Inform the user */ })
                
                })
            }
    </script>
</body>
</html>